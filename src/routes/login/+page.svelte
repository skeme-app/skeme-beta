<script lang="ts">
    import { goto } from "$app/navigation";
    import { currentUser, pb } from "$lib/pocketbase";
    import { onMount } from "svelte";

    let username: string;
    let password: string;

    async function login() {
        const user = await pb.collection("users").authWithPassword(username, password);
        console.log("[INFO] User signed in:", user);
        goto("/");
    }

    async function register() {
        try {
            const userData = {
                email: username,
                password: password,
                passwordConfirm: password,
            };
            const createdUser = await pb.collection("users").create(userData);
            console.log("[INFO] Successfully created user", createdUser)
            await login();
            goto("/") // redirect
        } catch (error) {
            console.log("[FATAL ERROR] Failed to register the user:", error)
        }
    }

    // onMount(() => {
    //     if ($currentUser) {
    //         goto("/")
    //     }
    // })

</script>

<!-- {#if !$currentUser} -->
<div class="pl-12 pt-24 flex flex-col justify-start h-full">
    <svg class="mb-8" width="52" height="12" viewBox="0 0 52 12" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g clip-path="url(#clip0_933_98)">
        <path d="M3.64642 11.7103C2.99362 11.7103 2.40802 11.5869 1.88962 11.34C1.37122 11.0829 0.958421 10.7383 0.651221 10.3063C0.353621 9.8743 0.190421 9.39601 0.161621 8.87144H2.19202C2.23042 9.20058 2.37922 9.47315 2.63842 9.68915C2.90722 9.90515 3.23842 10.0132 3.63202 10.0132C4.01602 10.0132 4.31362 9.93087 4.52482 9.7663C4.74562 9.60173 4.85602 9.39087 4.85602 9.13373C4.85602 8.85601 4.72162 8.6503 4.45282 8.51658C4.19362 8.37258 3.77602 8.2183 3.20002 8.05373C2.60482 7.89944 2.11522 7.74001 1.73122 7.57544C1.35682 7.41087 1.03042 7.15887 0.752021 6.81944C0.483221 6.48001 0.348821 6.0223 0.348821 5.4463C0.348821 4.97315 0.473621 4.54115 0.723221 4.1503C0.982421 3.75944 1.34722 3.45087 1.81762 3.22458C2.29762 2.9983 2.85922 2.88515 3.50242 2.88515C4.45282 2.88515 5.21122 3.1423 5.77762 3.65658C6.34402 4.16058 6.65602 4.84458 6.71362 5.70858H4.78402C4.75522 5.36915 4.62082 5.10173 4.38082 4.9063C4.15042 4.70058 3.83842 4.59773 3.44482 4.59773C3.08002 4.59773 2.79682 4.66973 2.59522 4.81373C2.40322 4.95773 2.30722 5.1583 2.30722 5.41544C2.30722 5.70344 2.44162 5.92458 2.71042 6.07887C2.97922 6.22287 3.39682 6.37201 3.96322 6.5263C4.53922 6.68058 5.01442 6.84001 5.38882 7.00458C5.76322 7.16915 6.08482 7.4263 6.35362 7.77601C6.63202 8.11544 6.77602 8.56801 6.78562 9.13373C6.78562 9.62744 6.65602 10.0697 6.39682 10.4606C6.14722 10.8514 5.78242 11.16 5.30242 11.3863C4.83202 11.6023 4.28002 11.7103 3.64642 11.7103ZM13.1637 11.5714L10.4565 7.9303V11.5714H8.4405V0.154297H10.4565V6.64973L13.1349 3.02401H15.7557L12.2421 7.31315L15.7845 11.5714H13.1637ZM24.2659 7.11258C24.2659 7.42115 24.2467 7.69887 24.2083 7.94573H18.3763C18.4243 8.56287 18.6259 9.0463 18.9811 9.39601C19.3363 9.74573 19.7731 9.92058 20.2915 9.92058C21.0403 9.92058 21.5731 9.57601 21.8899 8.88687H24.0643C23.8339 9.70973 23.3923 10.3886 22.7395 10.9234C22.0867 11.448 21.2851 11.7103 20.3347 11.7103C19.5667 11.7103 18.8755 11.5303 18.2611 11.1703C17.6563 10.8 17.1811 10.2806 16.8355 9.61201C16.4995 8.94344 16.3315 8.17201 16.3315 7.29773C16.3315 6.41315 16.4995 5.63658 16.8355 4.96801C17.1715 4.29944 17.6419 3.78515 18.2467 3.42515C18.8515 3.06515 19.5475 2.88515 20.3347 2.88515C21.0931 2.88515 21.7699 3.06001 22.3651 3.40973C22.9699 3.75944 23.4355 4.2583 23.7619 4.9063C24.0979 5.54401 24.2659 6.27944 24.2659 7.11258ZM22.1779 6.49544C22.1683 5.94001 21.9811 5.49773 21.6163 5.16858C21.2515 4.82915 20.8051 4.65944 20.2771 4.65944C19.7779 4.65944 19.3555 4.82401 19.0099 5.15315C18.6739 5.47201 18.4675 5.91944 18.3907 6.49544H22.1779ZM35.6446 2.90058C36.6238 2.90058 37.411 3.22458 38.0062 3.87258C38.611 4.5103 38.9134 5.40515 38.9134 6.55715V11.5714H36.8974V6.8503C36.8974 6.18173 36.739 5.67258 36.4222 5.32287C36.1054 4.96287 35.6734 4.78287 35.1262 4.78287C34.579 4.78287 34.1422 4.96287 33.8158 5.32287C33.499 5.67258 33.3406 6.18173 33.3406 6.8503V11.5714H31.3246V6.8503C31.3246 6.18173 31.1662 5.67258 30.8494 5.32287C30.5326 4.96287 30.1006 4.78287 29.5534 4.78287C28.9966 4.78287 28.555 4.96287 28.2286 5.32287C27.9118 5.67258 27.7534 6.18173 27.7534 6.8503V11.5714H25.7374V3.02401H27.7534V4.05773C28.0126 3.69773 28.3438 3.41487 28.747 3.20915C29.1598 3.00344 29.611 2.90058 30.1006 2.90058C30.7246 2.90058 31.2814 3.04458 31.771 3.33258C32.2606 3.6103 32.6398 4.01144 32.9086 4.53601C33.1678 4.0423 33.5422 3.6463 34.0318 3.34801C34.531 3.04973 35.0686 2.90058 35.6446 2.90058ZM48.2424 7.11258C48.2424 7.42115 48.2232 7.69887 48.1848 7.94573H42.3528C42.4008 8.56287 42.6024 9.0463 42.9576 9.39601C43.3128 9.74573 43.7496 9.92058 44.268 9.92058C45.0168 9.92058 45.5496 9.57601 45.8664 8.88687H48.0408C47.8104 9.70973 47.3688 10.3886 46.716 10.9234C46.0632 11.448 45.2616 11.7103 44.3112 11.7103C43.5432 11.7103 42.852 11.5303 42.2376 11.1703C41.6328 10.8 41.1576 10.2806 40.812 9.61201C40.476 8.94344 40.308 8.17201 40.308 7.29773C40.308 6.41315 40.476 5.63658 40.812 4.96801C41.148 4.29944 41.6184 3.78515 42.2232 3.42515C42.828 3.06515 43.524 2.88515 44.3112 2.88515C45.0696 2.88515 45.7464 3.06001 46.3416 3.40973C46.9464 3.75944 47.412 4.2583 47.7384 4.9063C48.0744 5.54401 48.2424 6.27944 48.2424 7.11258ZM46.1544 6.49544C46.1448 5.94001 45.9576 5.49773 45.5928 5.16858C45.228 4.82915 44.7816 4.65944 44.2536 4.65944C43.7544 4.65944 43.332 4.82401 42.9864 5.15315C42.6504 5.47201 42.444 5.91944 42.3672 6.49544H46.1544Z" fill="black"/>
        <path d="M50.6068 11.6795C50.242 11.6795 49.9396 11.5612 49.6996 11.3246C49.4692 11.0777 49.354 10.7743 49.354 10.4143C49.354 10.0543 49.4692 9.75603 49.6996 9.51946C49.9396 9.2726 50.242 9.14917 50.6068 9.14917C50.962 9.14917 51.2548 9.2726 51.4852 9.51946C51.7156 9.75603 51.8308 10.0543 51.8308 10.4143C51.8308 10.7743 51.7156 11.0777 51.4852 11.3246C51.2548 11.5612 50.962 11.6795 50.6068 11.6795Z" fill="#FF5C00"/>
        </g>
        <defs>
        <clipPath id="clip0_933_98">
        <rect width="52" height="12" fill="white"/>
        </clipPath>
        </defs>
        </svg>
    <div class="flex flex-col space-y-2">
        <h1 class="text-2xl font-medium">Wilkommen,</h1>
        <h1 class="text-lg font-medium text-[#999999]">zum Fortfahren bitte anmelden</h1>
    </div>
    <form on:submit|preventDefault class="mt-24 flex flex-col space-y-12">
    
        <input
        class="py-3 border-b-2 focus:outline-none"
          placeholder="E-Mail"
          type="text"
          bind:value={username}
          required
        />
    
        <input 
        class="py-3 border-b-2"
          placeholder="Passwort" 
          type="password" 
          bind:value={password}
          required 
        />
        <div>
            <button on:click={login} class="space-x-3 flex justify-between items-center px-8 py-4 mt-3 bg-[#eb5a23] text-white rounded-full font-medium text-sm">
                <div class="tracking-wide">Anmelden</div>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-4">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
                </svg>
            </button>
        </div>
      </form>
      <a href="/register"></a>
</div>

<!-- {/if} -->