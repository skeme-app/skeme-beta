<script lang="ts">
  import {currentUser, pb} from "$lib/pocketbase";
  import {onMount, onDestroy} from "svelte";
  import dayjs from "dayjs"; 
  import "dayjs/locale/de";

  dayjs.locale("de")
  
  const today: dayjs.Dayjs = dayjs();

  let cardsData = [];
  let unsubscribe: () => void;

  onMount(async () => {
    const results = await pb.collection("plans").getList(1, 2, { sort: "created" });
    cardsData = results.items;

    console.log(cardsData);

    unsubscribe = await pb.collection("plans").subscribe("*", async ({ action, record }) => {
      if (action === "create") {
        cardsData = [...cardsData, record];
      }
      if (action === "delete") {
        cardsData = cardsData.filter((m) => m.id !== record.id);
      }
    });
    console.log(cardsData)
  });

  onDestroy(() => {
    unsubscribe?.();
  });

  const sampleData = [{
    data: "",
    createdAt: "06.03.2023",
    destinationDate: dayjs("03/08/2023", "MM/DD/YYYY"),
  }, {
    data: "",
    createdAt: "06.03.2023",
    destinationDate: dayjs("03/09/2023", "MM/DD/YYYY"),
  }]

  // console.log(cardsData)
</script>

{#each sampleData as data}
  
<div class={`relative overflow-hidden rounded-3xl space-y-2 px-6 py-16 ${dayjs(data.destinationDate, "DD.MM.YYYY").isSame(today, "day") ? "bg-[#eb5a23] text-white" : "bg-[#eeeeee]"}`}>
  <h1 class="text-xl font-medium">{dayjs(data.destinationDate, "DD.MM.YYYY").isSame(today, "day") ? "Heute" : "Morgen"}</h1>
  <p class={`text-xs ${!dayjs(data.destinationDate, "DD.MM.YYYY").isSame(today, "day") && "text-[#999999]"}`}>{dayjs(data.destinationDate, "DD.MM.YYYY", "de").format("dddd, D. MMMM YYYY")}</p>
  <svg class="absolute -bottom-[12%] right-[10%] transform-gpu scale-90" width="118" height="157" viewBox="0 0 118 157" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M117.75 137.375V44.1562L73.5938 0H19.625C14.4201 0 9.42843 2.06763 5.74803 5.74803C2.06763 9.42843 0 14.4201 0 19.625V137.375C0 142.58 2.06763 147.572 5.74803 151.252C9.42843 154.932 14.4201 157 19.625 157H98.125C103.33 157 108.322 154.932 112.002 151.252C115.682 147.572 117.75 142.58 117.75 137.375ZM73.5938 29.4375C73.5938 33.3412 75.1445 37.0849 77.9048 39.8452C80.6651 42.6055 84.4088 44.1562 88.3125 44.1562H107.938V137.375C107.938 139.977 106.904 142.473 105.063 144.313C103.223 146.154 100.727 147.188 98.125 147.188H19.625C17.0226 147.188 14.5267 146.154 12.6865 144.313C10.8463 142.473 9.8125 139.977 9.8125 137.375V19.625C9.8125 17.0226 10.8463 14.5267 12.6865 12.6865C14.5267 10.8463 17.0226 9.8125 19.625 9.8125H73.5938V29.4375Z" fill="white" fill-opacity="0.9"/>
    <path d="M25.542 138.229C23.6295 137.464 22.0886 135.986 21.2441 134.107C19.3307 130.3 19.9685 126.493 22.0291 123.294C23.972 120.281 27.1905 117.72 30.8309 115.571C35.4422 112.956 40.3166 110.835 45.3731 109.242C49.2999 102.183 52.7804 94.8848 55.7939 87.39C53.9921 83.2959 52.5795 79.0415 51.5746 74.6828C50.7307 70.7578 50.4069 66.8721 51.1232 63.5358C51.8591 60.0622 53.8118 56.9418 57.5013 55.4601C59.3853 54.7046 61.4263 54.2826 63.4084 54.7046C64.4055 54.9168 65.3428 55.3483 66.1524 55.9678C66.9619 56.5873 67.6235 57.3792 68.089 58.2861C68.9525 59.8954 69.2665 61.7794 69.3352 63.5653C69.4039 65.41 69.2174 67.451 68.874 69.5901C68.0497 74.5945 66.2246 80.7175 63.7715 87.1937C66.4787 92.9833 69.6968 98.5199 73.3877 103.738C77.7553 103.393 82.1481 103.557 86.4776 104.228C90.0494 104.876 93.68 106.142 95.8976 108.791C97.0751 110.204 97.7914 111.931 97.8601 113.874C97.9288 115.758 97.3989 117.622 96.506 119.398C95.7325 121.044 94.5333 122.454 93.0324 123.48C91.5488 124.448 89.7972 124.922 88.028 124.835C84.7801 124.697 81.6106 122.911 78.8729 120.743C75.544 117.99 72.5443 114.862 69.9337 111.421C63.2981 112.174 56.7411 113.507 50.3382 115.405C47.406 120.605 44.0589 125.56 40.3294 130.222C37.4642 133.656 34.3536 136.659 31.2332 137.944C29.4404 138.755 27.4068 138.857 25.542 138.229V138.229ZM39.0734 119.575C37.4446 120.321 35.9334 121.106 34.5695 121.91C31.351 123.814 29.2609 125.669 28.2208 127.278C27.2984 128.701 27.2788 129.731 27.8283 130.82C27.9264 131.036 28.0246 131.173 28.0834 131.252C28.2005 131.221 28.3153 131.181 28.4269 131.134C29.7712 130.585 31.9103 128.828 34.6578 125.521C36.2204 123.608 37.6938 121.624 39.0734 119.575V119.575ZM55.1659 106.524C58.4426 105.76 61.7488 105.128 65.0766 104.631C63.2899 101.896 61.6202 99.0875 60.0722 96.2114C58.5331 99.6909 56.8971 103.127 55.1659 106.515V106.524ZM79.1673 110.94C80.6392 112.539 82.0718 113.884 83.4357 114.963C85.7907 116.827 87.4294 117.446 88.3224 117.475C88.5614 117.506 88.804 117.454 89.0092 117.328C89.4174 117.006 89.7352 116.583 89.9316 116.101C90.2805 115.504 90.4791 114.83 90.5106 114.139C90.5049 113.908 90.414 113.688 90.2554 113.521C89.7452 112.912 88.2929 112.029 85.1726 111.47C83.1877 111.138 81.1797 110.964 79.1673 110.95V110.94ZM59.6404 76.5374C60.4663 73.8735 61.1218 71.1598 61.6029 68.4126C61.9071 66.5679 62.0249 65.0469 61.9758 63.8498C61.9785 63.1893 61.8724 62.5329 61.6618 61.9069C61.1709 61.9677 60.6916 62.0999 60.239 62.2994C59.3853 62.6429 58.6886 63.3396 58.3157 65.0764C57.9232 66.9604 58.0214 69.6784 58.7671 73.1423C59.0026 74.2314 59.297 75.3697 59.6502 76.5374H59.6404Z" fill="white" fill-opacity="0-9"/>
  </svg>  
</div>
{/each}